version: v1.0
name: First pipeline example
agent:
  machine:
    type: e1-standard-2
    os_image: ubuntu1804
blocks:
  - name: "Build"
    task:
      env_vars:
        - name: APP_ENV
          value: prod
        - name: RVERSION
          value: devel
      jobs:
      - name: Clean data
        commands:
          #- curl -OL https://raw.githubusercontent.com/gaborcsardi/r-builder/master/pkg-build.sh
          #- chmod 755 pkg-build.sh
          #- ./pkg-build.sh bootstrap
          #- ./pkg-build.sh install_deps
          #- ./pkg-build.sh run_tests
          - checkout
          - ls
          #- cd hoyodecrimen.clean && Rscript run-all.R
          - echo "done"
  - name: "Docker Image"
    task:
      jobs:
      - name: Build with docker
        commands:
          - checkout
          - docker pull rocker/geospatial
          - docker images
          - docker run --entrypoint /bin/sh -v $SEMAPHORE_GIT_DIR/hoyodecrimen.clean:/hoyodecrimen rocker/geospatial -c "cd /hoyodecrimen && Rscript run-all.R" 
